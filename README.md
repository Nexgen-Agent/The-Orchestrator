# Frontier Orchestration Gateway (FOG)

FOG is a scalable orchestration and coordination gateway that sits at the front of a multi-AI ecosystem. It dispatches tasks to external supporting systems (agents), tracks task lifecycles, and manages system state and backups.

## Core Features

- **Agent Registration**: Dynamically connect supporting systems/agents.
- **Task Dispatching**: Structured task packets validated with Pydantic.
- **State Management**: File-based JSON store for tracking tasks, agents, and backups.
- **Automatic Backups**: Versioned snapshots before any modification tasks.
- **Rollback Support**: Quickly revert projects to a previous state.
- **Dependency Mapping**: Scan Python projects to build import dependency graphs.
- **Audit Trail**: Structured logging of all orchestration decisions and actions.

## Installation

1. Install dependencies:
   ```bash
   pip install fastapi pydantic uvicorn httpx networkx
   ```

2. The project structure is as follows:
   - `fog/api`: FastAPI application and endpoints.
   - `fog/core`: Core logic (Engine, Backup, Mapper, etc.).
   - `fog/models`: Pydantic schemas.
   - `backups/`: Directory for project snapshots.
   - `storage/`: Directory for state and audit logs.

## Running the Gateway

Start the FastAPI server:
```bash
python3 -m fog.api.main
```
The API will be available at `http://localhost:8000`.

## API Endpoints

- `POST /register-agent`: Register a new agent connector.
- `POST /submit-project`: Submit a project path for tracking and initial backup.
- `POST /submit-task`: Dispatch a task packet to a registered agent.
- `GET /task-status/{id}`: Check the status of a specific task.
- `POST /rollback/{backup_id}`: Roll back a project to a specific version.
- `GET /dependency-map?project_path=...`: Generate a dependency graph for a Python project.
- `GET /system-state`: View the current state of the gateway.

## Example Usage

Check `examples/run_orchestration.py` for a full demonstration of the gateway's capabilities, including agent registration, task submission, auto-backup, and rollback.

To run the demo:
```bash
export PYTHONPATH=$PYTHONPATH:.
python3 examples/run_orchestration.py
```

## Running Tests

Run the unit test suite:
```bash
export PYTHONPATH=$PYTHONPATH:.
python3 -m unittest discover tests
```

## Supporting Agents

### Code Structure Analyzer Agent
This agent analyzes Python files and extracts structural metadata (classes, functions, imports, decorators, etc.). It is designed to be used as a supporting system for FOG.

**Key Features:**
- Recursive scanning of `.py` files.
- Extraction of classes, inheritance, functions, methods, and decorators.
- Detection of internal vs. external imports.
- Line counts per file and per structural element.
- JSON output schema for easy integration.

**Usage (Standalone):**
```bash
python3 agents/structure_analyzer/main.py <path_to_project>
```

**Integration with FOG:**
The agent provides a `handle_task` function in `agents/structure_analyzer/handler.py` that can be registered with FOG as a mock or HTTP connector.

### Dependency Graph Agent
This agent creates a module dependency graph from the structural metadata generated by the Code Structure Analyzer.

**Key Features:**
- Builds directed dependency graphs using `networkx`.
- Detects circular dependencies.
- Identifies shared, leaf, and core modules.
- Exports graph JSON, adjacency lists, and centrality rankings.
- Provides comprehensive graph statistics.

**Usage (Standalone):**
```bash
python3 agents/dependency_graph/main.py <path_to_analyzer_json>
```

**Integration with FOG:**
The agent provides a `handle_task` function in `agents/dependency_graph/handler.py` that can be registered with FOG. It expects the output of the Structure Analyzer as input.

### Logic Summarizer Agent
This agent provides human-readable explanations of Python modules by leveraging Large Language Models (LLMs).

**Key Features:**
- Pluggable LLM connector interface (no vendor lock-in).
- Automatic chunking of long files for LLM context limits.
- Generates summary, purpose, module role, and risk complexity score.
- Structured JSON output.

**Usage (Standalone):**
```bash
python3 agents/logic_summarizer/main.py --file <path_to_file>
```

**Integration with FOG:**
The agent provides a `handle_task` function in `agents/logic_summarizer/handler.py` that can be registered with FOG. It expects a `file_path` or `text` in the task payload.

### Semantic Intent Tagging Agent
This agent tags code and documents with business, psychology, and philosophy signals, providing insights into the semantic intent of the content.

**Key Features:**
- Detects decision rules, persuasion logic, business flows, and behavioral triggers.
- Categorizes tags (business, psychology, philosophy).
- Provides confidence scores per detected tag.
- Pluggable AI model interface.
- Structured JSON output.

**Usage (Standalone):**
```bash
python3 agents/semantic_tagger/main.py --text "If you buy now, we will process your order immediately."
```

**Integration with FOG:**
The agent provides a `handle_task` function in `agents/semantic_tagger/handler.py` that can be registered with FOG. It expects a `file_path` or `text` in the task payload.

### Code Quality Evaluation Agent
This agent evaluates Python code quality and risk signals.

**Key Features:**
- Computes cyclomatic complexity per function.
- Detects long functions and deep nesting.
- Identifies risky operations missing try/except blocks.
- Finds unused imports.
- Provides a weighted quality score (1-100) per file.
- Generates structured JSON risk reports.

**Usage (Standalone):**
```bash
python3 agents/code_quality/main.py --path <path_to_project>
```

**Integration with FOG:**
The agent provides a `handle_task` function in `agents/code_quality/handler.py` that can be registered with FOG. It expects a `project_path` or `file_path` in the task payload.

### Backup Verification Agent
This agent verifies the integrity of project backups by comparing file hashes and validating archive structures.

**Key Features:**
- Calculates SHA256 hashes for file comparison.
- Validates zip archive integrity using CRC checks.
- Detects mismatched or missing files between a backup and a project directory.
- Produces structured verification reports.

**Usage (Standalone):**
```bash
python3 agents/backup_verifier/main.py <path_to_backup_zip> --project <path_to_project>
```

**Integration with FOG:**
The agent provides a `handle_task` function in `agents/backup_verifier/handler.py` that can be registered with FOG. It expects an `archive_path` and optionally a `project_path` in the task payload.

### Prompt Orchestration Agent
This agent generates structured build instructions for AI models based on architectural dependency maps.

**Key Features:**
- Dependency-aware topological sorting of build steps.
- Generates detailed Component Instructions (purpose, steps, constraints).
- Produces structured prompts for AI builders.
- Maintains modular build hierarchies.

**Usage (Standalone):**
```bash
python3 agents/prompt_orchestrator/main.py <path_to_architecture_json>
```

**Integration with FOG:**
The agent provides a `handle_task` function in `agents/prompt_orchestrator/handler.py`. It expects an `architecture_map` in the task payload.

### Security Analysis Agent
This agent scans Python code for security risks, including hardcoded secrets and unsafe code patterns.

**Key Features:**
- Detects hardcoded secrets (API keys, tokens, etc.) using regex.
- Identifies unsafe code patterns (e.g., `eval`, `exec`, `os.system`) via AST analysis.
- Flags risky dependencies (e.g., `pickle`).
- Categorizes risk severity (Low, Medium, High, Critical).
- Produces structured security reports.

**Usage (Standalone):**
```bash
python3 agents/security_analyzer/main.py --path <path_to_project>
```

**Integration with FOG:**
The agent provides a `handle_task` function in `agents/security_analyzer/handler.py`. It expects a `project_path` or `file_path` in the task payload.

### System Monitoring Agent
This agent monitors system and agent health, tracking uptime, task success rates, and detecting failure patterns.

**Key Features:**
- Tracks agent availability.
- Calculates real-time task success rates and retry metrics.
- Detects recurring failure patterns (e.g., unstable agents).
- Produces comprehensive system health reports.

**Usage (Standalone):**
```bash
python3 agents/system_monitor/main.py
```

**Integration with FOG:**
The agent provides a `handle_task` function in `agents/system_monitor/handler.py`. It leverages the global `state_store` to analyze system metrics.

### Deployment Preparation Agent
This agent prepares Python projects for deployment by generating necessary configuration files and detecting missing dependencies.

**Key Features:**
- Generates `Dockerfile` for containerization.
- Generates `requirements.txt` by scanning project imports.
- Builds `start.sh` startup scripts.
- Detects potentially missing dependencies.
- Produces structured deployment reports.

**Usage (Standalone):**
```bash
python3 agents/deployment_preparer/main.py <path_to_project> --write
```

**Integration with FOG:**
The agent provides a `handle_task` function in `agents/deployment_preparer/handler.py`. It expects a `project_path` in the task payload.

### Automated Test Generator Agent
This agent generates Python unit tests from module structure metadata, helping to improve test coverage.

**Key Features:**
- Generates `pytest` test stubs for classes and functions.
- Detects missing test coverage by comparing project structure with existing tests.
- Produces complete, runnable test files.
- Provides coverage recommendations and importance levels.

**Usage (Standalone):**
```bash
python3 agents/test_generator/main.py <path_to_analyzer_json> --write
```

**Integration with FOG:**
The agent provides a `handle_task` function in `agents/test_generator/handler.py`. It expects a `project_analysis` (from Structure Analyzer) in the task payload.

### Orchestration Optimization Agent
This agent analyzes orchestration task history and logs to improve routing efficiency and system performance.

**Key Features:**
- Parses orchestration logs to extract performance metrics.
- Detects slow agents and high failure rates.
- Identifies recurring failure patterns.
- Recommends improvements for routing, timeouts, and retries.
- Produces execution performance metrics and optimization suggestions.

**Usage (Standalone):**
```bash
python3 agents/orchestration_optimizer/main.py --logs storage/audit.log
```

**Integration with FOG:**
The agent provides a `handle_task` function in `agents/orchestration_optimizer/handler.py` that analyzes the system's audit logs.

### Autonomous Evolution Coordinator
This agent coordinates system-wide agent improvements by monitoring performance, triggering improvement cycles, and applying upgrades safely.

**Key Features:**
- Monitors agent performance metrics (success rate, retries).
- Automatically triggers improvement cycles for underperforming agents.
- Ensures safety by requiring backups before any changes are applied.
- Tracks the evolution history of the entire ecosystem.

**Usage (Standalone):**
```bash
python3 agents/evolution_coordinator/main.py --action trigger
```

**Integration with FOG:**
The agent provides a `handle_task` function in `agents/evolution_coordinator/handler.py`. It can trigger a cycle or apply a specific evolution step.
